<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>Docker Partie 3</title>
    <meta name="description" content="">
    <meta name="keywords" content='blog, makhal, cyber, SIEM, BUT R&amp;T, docker'>

    <meta property="og:url" content="https://makhal.fr/posts/docker/docker_3/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Docker Partie 3">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://makhal.fr/images/avatar.jpg">
    <meta property="og:image:secure_url" content="https://makhal.fr/images/avatar.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Docker Partie 3">
    <meta name="twitter:description" content="">
    <meta property="twitter:domain" content="https://makhal.fr/posts/docker/docker_3/">
    <meta property="twitter:url" content="https://makhal.fr/posts/docker/docker_3/">
    <meta name="twitter:image" content="https://makhal.fr/images/avatar.jpg">

    
    <link rel="canonical" href="https://makhal.fr/posts/docker/docker_3/" />

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.893af8dd3b65bd0ffe90e7af33847bd6dc9180b8fa6d6659a212a6f4b62d3e01.js" integrity="sha256-iTr43TtlvQ/&#43;kOevM4R71tyRgLj6bWZZohKm9LYtPgE="></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6QF6WSBEBS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-6QF6WSBEBS');
    </script>
    
    
          <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&display=swap">
    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">
        
        
            <div class="avatar">
                <a href="https://makhal.fr/">
                    <img src="https://makhal.fr//images/avatar.jpg" alt="avatar" />
                </a>
            </div>
        

        
        <div class="nav-title">
            <a class="nav-brand" href="https://makhal.fr/">makhal.fr</a>
        </div>

        
        <div class="nav-links">
            
                <div class="nav-link">
                    <a href="https://makhal.fr/posts/"> Posts </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://makhal.fr/tags/"> Tags </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://makhal.fr/pages/about/"> About </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://www.linkedin.com/in/mohamad-el-akhal-8b8319221/"><span data-feather='linkedin'></span>  </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://github.com/tutanka01"><span data-feather='github'></span>  </a>
                </div>
            

            
            <span class="nav-icons-divider"></span>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">   
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/posts/"> Posts </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/tags/"> Tags </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/pages/about/"> About </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://www.linkedin.com/in/mohamad-el-akhal-8b8319221/"><span data-feather='linkedin'></span>  </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://github.com/tutanka01"><span data-feather='github'></span>  </a>
                    </li>
                
        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Docker Partie 3</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">
            février 18, 2024
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://makhal.fr/tags/docker">docker</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <h1 id="docker-partie-3">Docker Partie 3</h1>
<h2 id="docker-compose">Docker-Compose</h2>
<p>Normalement, vous avez déjà une idée de ce qu&rsquo;est Docker, et comment l&rsquo;utiliser. Au moins vous captez le concept de base. Mais, si vous avez déjà essayé de lancer plusieurs conteneurs en même temps, vous avez dû vous rendre compte que c&rsquo;est un peu complique. Vous devez lancer chaque conteneur un par un, et vous devez vous souvenir des commandes pour chaque conteneur. C&rsquo;est là que Docker-Compose entre en jeu.</p>
<p>Surtout quand vous voulez les faire communiquer entre eux, c&rsquo;est un peu complique. Vous devez vous souvenir des noms des conteneurs, des reseaux qui lui sont associés, des ports qu&rsquo;ils exposent, etc&hellip;</p>
<p>Docker-Compose est un outil qui vous permet de définir et de lancer des applications multi-conteneurs. Avec Docker-Compose, vous pouvez utiliser un fichier YAML pour configurer vos services. Vous pouvez ensuite lancer tous vos services avec une seule commande.</p>
<blockquote>
<p>Note: Docker-Compose est un outil qui est installé avec Docker. Donc, si vous avez déjà installé Docker, vous avez déjà Docker-Compose.</p></blockquote>
<h2 id="un-exemple-simple">Un exemple simple</h2>
<p>Pour commencer, je vais vous montrer un exemple simple. Nous allons créer un fichier <code>compose.yaml</code> qui va lancer un conteneur <code>nginx</code> et un conteneur <code>mysql</code>. Voici le contenu du fichier <code>docker-compose.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">web</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;8080:80&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">db</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">mysql:latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">MYSQL_ROOT_PASSWORD</span>: <span style="color:#ae81ff">example</span>
</span></span></code></pre></div><p>Pour le moment rien de complique, nous avons juste deux services, <code>web</code> et <code>db</code>. Le service <code>web</code> utilise l&rsquo;image <code>nginx:latest</code>, et il expose le port <code>80</code> du conteneur sur le port <code>8080</code> de l&rsquo;hôte. Le service <code>db</code> utilise l&rsquo;image <code>mysql:latest</code>, et il définit la variable d&rsquo;environnement <code>MYSQL_ROOT_PASSWORD</code> à <code>example</code>.</p>
<p>Ce Docker-Compose, est la traduction exacte de ce que une commande <code>docker run</code> ferait. :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d -p 8080:80 nginx:latest
</span></span><span style="display:flex;"><span>docker run -d -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span>example mysql:latest
</span></span></code></pre></div><p>C&rsquo;est juste qu&rsquo;avec Docker-Compose, vous pouvez lancer les deux services en même temps. Et en plus vous pouvez envoyer ce fichier à un autre développeur, et il pourra lancer les mêmes services avec la même configuration. C&rsquo;est très pratique.</p>
<p>Comme je l&rsquo;ai ai dit dans la partie 2. Chaque image a ses propres variables d&rsquo;environnement. Vous pouvez les trouver dans la documentation de l&rsquo;image. Par exemple, pour l&rsquo;image <code>mysql</code>, vous pouvez trouver les variables d&rsquo;environnement <a href="https://hub.docker.com/_/mysql">ici</a>.</p>
<p>Du coup, pour lancer ces deux services, vous pouvez utiliser la commande suivante:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker compose up
</span></span></code></pre></div><p>Et voila ! Vous avez lancé deux conteneurs en même temps. Cela dans cet exemple ne semble pas très utile, mais imaginez que vous avez une application qui utilise plusieurs services. Vous pouvez les lancer tous en même temps avec une seule commande. C&rsquo;est très pratique.</p>
<h2 id="exemple-plus-complique">Exemple plus complique</h2>
<p>Pour vous expliquer toutes les options qu&rsquo;on peut utiliser avec Docker-Compose, je vais vous donner un exemple plus complique. Nous allons créer un fichier <code>docker-compose.yml</code> qui va lancer un tres fameux gestionnaire de logs, Graylog. Graylog est un outil open-source qui permet de collecter, d&rsquo;analyser et de stocker des logs. Il est très utile pour les administrateurs système. Je ne vais pas vous expliquer comment utiliser Graylog, mais je vais vous montrer comment le lancer avec Docker-Compose.</p>
<p>Voici le contenu du fichier <code>docker-compose.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">mongodb</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">mongo:4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">mongo_data:/data/db</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">mongodb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">elasticsearch</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">docker.elastic.co/elasticsearch/elasticsearch:7.10.2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">discovery.type=single-node</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ulimits</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memlock</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">soft</span>: -<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">hard</span>: -<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">es_data:/usr/share/elasticsearch/data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">elasticsearch</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">graylog</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">graylog/graylog:4.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">GRAYLOG_HTTP_EXTERNAL_URI=http://</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;9000:9000&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;514:514&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;514:514/udp&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;12201:12201&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;12201:12201/udp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">depends_on</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">mongodb</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">elasticsearch</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">graylog_journal:/usr/share/graylog/data/journal</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">graylog_config:/usr/share/graylog/data/config</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">graylog_plugins:/usr/share/graylog/data/plugin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">graylog</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">mongo_data</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">es_data</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">graylog_journal</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">graylog_config</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">graylog_plugins</span>:
</span></span></code></pre></div><p>Voila, un docker compose un poil plus complexe que le précédent. Nous avons trois services, <code>mongodb</code>, <code>elasticsearch</code> et <code>graylog</code>. Le service <code>mongodb</code> utilise l&rsquo;image <code>mongo:4</code>, et il monte un volume pour stocker les données. Le service <code>elasticsearch</code> utilise l&rsquo;image <code>docker.elastic.co/elasticsearch/elasticsearch:7.10.2</code>, et il définit une variable d&rsquo;environnement <code>discovery.type</code> à <code>single-node</code>. Le service <code>graylog</code> utilise l&rsquo;image <code>graylog/graylog:4.0</code>, et il expose plusieurs ports. Il définit aussi une variable d&rsquo;environnement <code>GRAYLOG_HTTP_EXTERNAL_URI</code> à <code>http://</code>. Il dépend aussi des services <code>mongodb</code> et <code>elasticsearch</code>. Il monte aussi plusieurs volumes pour stocker les données.</p>
<p>Je suis sur vous n&rsquo;avez absolument rien compris. C&rsquo;est normal, c&rsquo;est un exemple complexe. Mais, je voulais juste vous montrer que vous pouvez faire des choses complique avec Docker-Compose. Vous pouvez lancer plusieurs services en même temps, et vous pouvez les faire communiquer entre eux.</p>
<p>Voila une explication de quelques option docker compose que vous pouvez utiliser dans un fichier <code>compose.yaml</code></p>
<ul>
<li><code>version</code>: La version de Docker-Compose. Vous pouvez utiliser la version 3 pour la plupart des cas.</li>
<li><code>services</code>: Les services que vous voulez lancer. Chaque service a un nom, et vous pouvez définir plusieurs options pour chaque service. Vous pouvez définir l&rsquo;image que vous voulez utiliser, les ports que vous voulez exposer, les variables d&rsquo;environnement que vous voulez définir, etc. Les configurations que vous allez definir en dessous d&rsquo;un service s&rsquo;appliqueront seulement à ce service.</li>
<li><code>volumes</code>: Les volumes ce sont des espaces de stockage persistant pour les conteneurs. Vous pouvez définir plusieurs volumes, et vous pouvez les utiliser dans les services.</li>
<li><code>networks</code>: On s&rsquo;attardera pas sur ce post mais c&rsquo;est pour définir les réseaux que vous voulez utiliser. Vous pouvez définir plusieurs réseaux, et vous pouvez les utiliser dans les services.</li>
<li><code>secrets</code>: Les secrets que vous voulez utiliser. Vous pouvez définir plusieurs secrets, et vous pouvez les utiliser dans les services.</li>
<li><code>configs</code>: Les configurations que vous voulez utiliser. Vous pouvez définir plusieurs configurations, et vous pouvez les utiliser dans les services.</li>
<li><code>restart</code>: L&rsquo;action à prendre si le conteneur s&rsquo;arrête. Vous pouvez définir <code>no</code> pour ne pas redémarrer le conteneur, <code>always</code> pour redémarrer le conteneur toujours, <code>on-failure</code> pour redémarrer le conteneur seulement si il s&rsquo;arrête avec une erreur, ou <code>unless-stopped</code> pour redémarrer le conteneur sauf si vous l&rsquo;arrêtez manuellement.</li>
<li><code>depends_on</code>: Les services sur lesquels le service dépend. Vous pouvez définir plusieurs services, et vous pouvez les utiliser dans les services.</li>
<li><code>container_name</code>: Le nom du conteneur. Vous pouvez définir un nom, et vous pouvez l&rsquo;utiliser dans les services.</li>
<li><code>ports</code>: Les ports que vous voulez exposer. Vous pouvez définir plusieurs ports, et vous pouvez les utiliser dans les services.</li>
<li><code>environment</code>: Les variables d&rsquo;environnement que vous voulez définir. Vous pouvez définir plusieurs variables, et vous pouvez les utiliser dans les services.</li>
<li>&hellip;.</li>
</ul>
<p>Si jamais vous voulez des informations plus détaillées sur les options que vous pouvez utiliser dans un fichier <code>compose.yaml</code>, vous pouvez consulter la documentation officielle <a href="https://docs.docker.com/compose/compose-file/">ici</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Bon, peut être que je vous ai un peu perdu avec l&rsquo;exemple de Graylog. Mais je voulais seulement vous montrer la puissance que docker compose peut vous offrir. Vous pouvez lancer plusieurs services en même temps, et en un claquement de doigts vous avez ce qui allait vous prendre des heures si vous aviez utilisé <code>docker run</code>. V</p>
<p>J&rsquo;espere que vous avez compris l&rsquo;essentiel de Docker-Compose.</p>

        </p>
        
        
    </div>

    <div class="prev-next">
        
            
                
<div class="prev-post">
    <p>
        <a href="/posts/docker/docker_2/">
            &#8592;
            :
            Docker Partie 2
        </a>
    </p>
    <p class="prev-post-date">
        février 11, 2024
    </p>
</div>



<div class="next-post">
    <p>
        <a href="/posts/docs/maj_ios_tftp/">
            :
            Mise a jour manuelle d&#39;un Switch Cisco par TFTP
            &#8594;
        </a>
    </p>
        <p class="next-post-date">
            avril 21, 2024
        </p>
</div>


            
        
    </div>
</div>



    

        </main><footer class="footer">
    
    

    
    <span>&copy; 2025 makhal.fr</span>
    
</footer>
</body>
</html>
