<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>Authelia &#43; Traefik : sécurisez tous vos services web</title>
    <meta name="description" content="">
    <meta name="keywords" content='blog, makhal, cyber, SIEM, BUT R&amp;T, sysadmin, authelia'>

    <meta property="og:url" content="https://makhal.fr/posts/sysadmin/authelia/authelia/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Authelia &#43; Traefik : sécurisez tous vos services web">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://makhal.fr/images/avatar.jpg">
    <meta property="og:image:secure_url" content="https://makhal.fr/images/avatar.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Authelia &#43; Traefik : sécurisez tous vos services web">
    <meta name="twitter:description" content="">
    <meta property="twitter:domain" content="https://makhal.fr/posts/sysadmin/authelia/authelia/">
    <meta property="twitter:url" content="https://makhal.fr/posts/sysadmin/authelia/authelia/">
    <meta name="twitter:image" content="https://makhal.fr/images/avatar.jpg">

    
    <link rel="canonical" href="https://makhal.fr/posts/sysadmin/authelia/authelia/" />

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.893af8dd3b65bd0ffe90e7af33847bd6dc9180b8fa6d6659a212a6f4b62d3e01.js" integrity="sha256-iTr43TtlvQ/&#43;kOevM4R71tyRgLj6bWZZohKm9LYtPgE="></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6QF6WSBEBS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-6QF6WSBEBS');
    </script>
    
    
          <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&display=swap">
    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">
        
        
            <div class="avatar">
                <a href="https://makhal.fr/">
                    <img src="https://makhal.fr//images/avatar.jpg" alt="avatar" />
                </a>
            </div>
        

        
        <div class="nav-title">
            <a class="nav-brand" href="https://makhal.fr/">makhal.fr</a>
        </div>

        
        <div class="nav-links">
            
                <div class="nav-link">
                    <a href="https://makhal.fr/posts/"> Posts </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://makhal.fr/tags/"> Tags </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://makhal.fr/pages/about/"> Bio </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://www.youtube.com/@makhalX"><span data-feather='youtube'></span>  </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://www.linkedin.com/in/mohamad-el-akhal-8b8319221/"><span data-feather='linkedin'></span>  </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://github.com/tutanka01"><span data-feather='github'></span>  </a>
                </div>
            

            
            <span class="nav-icons-divider"></span>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">   
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/posts/"> Posts </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/tags/"> Tags </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/pages/about/"> Bio </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://www.youtube.com/@makhalX"><span data-feather='youtube'></span>  </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://www.linkedin.com/in/mohamad-el-akhal-8b8319221/"><span data-feather='linkedin'></span>  </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://github.com/tutanka01"><span data-feather='github'></span>  </a>
                    </li>
                
        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Authelia &#43; Traefik : sécurisez tous vos services web</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">
            mai 28, 2025
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://makhal.fr/tags/cyber">cyber</a></li>
        
            <li class="post-tag"><a href="https://makhal.fr/tags/sysadmin">sysadmin</a></li>
        
            <li class="post-tag"><a href="https://makhal.fr/tags/authelia">authelia</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <p>L&rsquo;authentification et l&rsquo;autorisation sont le nerf de la guerre de la sécurité informatique. Rares sont les entreprises qui n&rsquo;ont jamais été victimes d&rsquo;une fuite de données à cause d&rsquo;un mot de passe compromis (credential theft). Mettre en place un système d&rsquo;authentification robuste et complet est chronophage et complexe.</p>
<p>Mais avec Authelia, vous pouvez centraliser l&rsquo;authentification et l&rsquo;authorisation de vos applications web et services, tout en l&rsquo;installant en à peine deux commandes (et quelques fichiers de configuration). Dans cet article, nous allons découvrir et mettre en place Authelia derrière un reverse proxy Traefik.</p>
<h2 id="mais-cest-quoi-lauthentification-">Mais c&rsquo;est quoi l&rsquo;authentification ?</h2>
<p><img src="/images/sysadmin/authelia/authentication-vs-authorization.jpg" alt="authentication-vs-authorization"></p>
<p>Avant de plonger dans Authelia, il faut comprendre un concepte clé de la sécurité informatique : l&rsquo;authentification et l&rsquo;autorisation.</p>
<p>L&rsquo;authentification est le processus de vérification de l&rsquo;identité d&rsquo;un utilisateur. Par exemple, lorsque vous vous connectez sur Instagram, vous donnez forcément votre nom d&rsquo;utilisateur et votre mot de passe. Ensuite, Instagram va vérifier que ces informations correspondent à un compte existant. Si c&rsquo;est le cas, vous avez accès à votre compte, sinon vous recommencez le processus d&rsquo;authentification.</p>
<p>L&rsquo;authentification est donc le processus de vérification de l&rsquo;identité d&rsquo;un utilisateur. Pour vérifier cette identité, on utilise souvent un nom d&rsquo;utilisateur et un mot de passe, mais il existe d&rsquo;autres méthodes telles que les OTP (One Time Password), les certificats, les WebAuthn, etc.</p>
<p>Cela s&rsquo;inscrit dans le fait qu&rsquo;on ne peut pas faire confiance à un seul mécanisme d&rsquo;authentification. Si on prend une analogie, si vous avez une porte avec une serrure, vous pouvez la déverrouiller avec une clé. Mais si quelqu&rsquo;un vole votre clé, il peut ouvrir la porte également. Donc vous, vous êtes intelligent, vous avez mis un lecteur d&rsquo;empreinte digitale en plus de la serrure. Maintenant, même si quelqu&rsquo;un vole votre clé, il ne pourra pas ouvrir la porte, car il ne possède pas votre empreinte digitale. C&rsquo;est ce qu&rsquo;on appelle l&rsquo;authentification à deux facteurs (2FA).</p>
<p><img src="/images/sysadmin/authelia/what-is-mfa-key-image.avif" alt="what-is-mfa-key-image"></p>
<p>Donc, comme vous l&rsquo;avez compris, l&rsquo;authentification est le processus de vérification de l&rsquo;identité d&rsquo;un utilisateur. Mais il y a un autre concept clé en sécurité informatique : l&rsquo;autorisation.</p>
<p>L&rsquo;autorisation est le processus de vérification des permissions d&rsquo;un utilisateur. Par exemple, si vous êtes connecté à votre compte Instagram, vous pouvez publier des photos, liker des publications, mais seulement depuis votre compte. Vous ne pouvez pas, bien évidemment, publier en tant que quelqu&rsquo;un d&rsquo;autre. Donc, Instagram vous a autorisé à publier des photos, mais seulement depuis votre compte.</p>
<p>Si on prend une analogie (j&rsquo;aime bien les exemples concrets) : Vous appelez depuis l&rsquo;interphone de votre immeuble pour que votre mère vous ouvre la porte. Elle vous reconnaît à votre voix et elle vous voit même depuis la fenêtre. Donc, vous êtes totalement authentifié. Mais elle refuse de vous ouvrir la porte car tu as oublié de ramener le pain. Donc, vous êtes authentifié, mais pas autorisé à entrer à la maison. Compris ?</p>
<h2 id="authelia-cest-quoi-">Authelia, c&rsquo;est quoi ?</h2>
<p>Après avoir compris les concepts d&rsquo;authentification et d&rsquo;autorisation, il est temps de découvrir Authelia.</p>
<p><img src="/images/sysadmin/authelia/cover.png" alt="Authelia logo"></p>
<p>Authelia est un serveur d&rsquo;authentification et d&rsquo;autorisation open source qui permet de sécuriser vos applications web et services. Il s&rsquo;intègre facilement avec Traefik, ou même n&rsquo;importe quel reverse proxy.</p>
<p>Le but est de diriger la requête d&rsquo;abord par Authelia, qui va vérifier l&rsquo;identité de l&rsquo;utilisateur et ses permissions, avant de rediriger la requête vers le service web ou l&rsquo;application. Donc, même si notre application web n&rsquo;est pas sécurisée, Authelia va s&rsquo;assurer que seuls les utilisateurs authentifiés et autorisés peuvent y accéder. C&rsquo;est vraiment pratique, surtout quand on expose des services web sur Internet.</p>
<h2 id="installation-dauthelia-avec-traefik">Installation d&rsquo;Authelia avec Traefik</h2>
<p>Le seul prérequis pour ce tuto est d&rsquo;avoir Traefik installé et fonctionnel ; je ferai très bientôt un article sur comment installer Traefik.</p>
<p>Pour installer Authelia, nous allons utiliser Docker et Docker Compose. Si vous n&rsquo;avez pas encore installé Docker ou même si vous ne savez pas ce qu&rsquo;est Docker, je vous recommande de suivre <a href="/posts/docker/docker_1/">ce guide</a> que j&rsquo;ai écrit.</p>
<p>Voilà le <code>docker-compose.yaml</code> pour installer Authelia :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">authelia</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">authelia</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">authelia/authelia:latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">unless-stopped</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">frontend  </span> <span style="color:#75715e"># Notre réseau Traefik</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./data/authelia/config:/config     </span> <span style="color:#75715e"># configuration.yml ici</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">./data/authelia/secrets:/secrets   </span> <span style="color:#75715e"># vos secrets JWT/SESSION/etc.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Montez ici vos secrets en fichiers dans ./data/authelia/secrets</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">AUTHELIA_JWT_SECRET_FILE</span>:        <span style="color:#ae81ff">/secrets/JWT_SECRET</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">AUTHELIA_SESSION_SECRET_FILE</span>:    <span style="color:#ae81ff">/secrets/SESSION_SECRET</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Exemple de stockage SQLite (pas besoin de Postgres pour un lab)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">AUTHELIA_STORAGE_ENCRYPTION_KEY_FILE</span>: <span style="color:#ae81ff">/secrets/ENCRYPTION_KEY</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">AUTHELIA_STORAGE_LOCAL_PATH</span>:     <span style="color:#ae81ff">/config/db.sqlite3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.enable=true&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># HTTP → HTTPS</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.routers.authelia.entrypoints=http&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.routers.authelia.rule=Host(`auth.makhal.tuto`)&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.routers.authelia.middlewares=authelia-https-redirect&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia-https-redirect.redirectscheme.scheme=https&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># HTTPS</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.routers.authelia-secure.entrypoints=https&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.routers.authelia-secure.rule=Host(`auth.makhal.tuto`)&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.routers.authelia-secure.tls=true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.routers.authelia-secure.tls.certresolver=cloudflare&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.routers.authelia-secure.service=authelia&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.services.authelia.loadbalancer.server.port=9091&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># MIDDLEWARES AUTHELIA (à ajouter)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Middleware Forward Auth</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia.forwardauth.address=http://authelia:9091/api/verify?rd=https://auth.makhal.tuto&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia.forwardauth.trustForwardHeader=true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia.forwardauth.authResponseHeaders=Remote-User,Remote-Groups,Remote-Name,Remote-Email&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Middleware Auth Headers (optionnel mais recommandé)</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia-headers.headers.SSLRedirect=true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia-headers.headers.STSSeconds=315360000&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia-headers.headers.browserXSSFilter=true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia-headers.headers.contentTypeNosniff=true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia-headers.headers.forceSTSHeader=true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia-headers.headers.STSIncludeSubdomains=true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;traefik.http.middlewares.authelia-headers.headers.STSPreload=true&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networks</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">frontend</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">external</span>: <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>Donc, pour expliquer un peu ce <code>docker-compose.yaml</code>, on a :</p>
<ul>
<li>Un service <code>authelia</code> qui utilise l&rsquo;image officielle d&rsquo;Authelia.</li>
<li>On monte les volumes pour la configuration et les secrets.</li>
<li>On définit les variables d&rsquo;environnement pour les secrets JWT, SESSION et la clé de chiffrement.</li>
<li>On configure les labels Traefik pour activer Authelia en HTTP et HTTPS.</li>
<li>On ajoute les middlewares pour l&rsquo;authentification et les headers de sécurité.</li>
</ul>
<h3 id="configuration-dauthelia">Configuration d&rsquo;Authelia</h3>
<p>D&rsquo;abord, commençons par créer le dossier de configuration d&rsquo;Authelia :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd authelia  <span style="color:#75715e"># Assurez-vous d&#39;être dans le bon répertoire parent si besoin</span>
</span></span><span style="display:flex;"><span>mkdir -p ./data/authelia/config
</span></span><span style="display:flex;"><span>mkdir -p ./data/authelia/secrets
</span></span></code></pre></div><p>Ensuite, on va créer nos secrets JWT, SESSION et ENCRYPTION_KEY. Vous pouvez utiliser <code>openssl</code> pour générer des secrets aléatoires :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl rand -base64 <span style="color:#ae81ff">32</span> &gt; ./data/authelia/secrets/JWT_SECRET
</span></span><span style="display:flex;"><span>openssl rand -base64 <span style="color:#ae81ff">32</span> &gt; ./data/authelia/secrets/SESSION_SECRET
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Pensez à générer également ENCRYPTION_KEY si vous utilisez le stockage local chiffré</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># openssl rand -base64 64 &gt; ./data/authelia/secrets/ENCRYPTION_KEY</span>
</span></span></code></pre></div><p>Ces secrets seront utilisés par Authelia pour signer les tokens JWT et les sessions. Et donc logiquement, la clé de chiffrement doit être suffisamment longue pour garantir la sécurité des données stockées.</p>
<p>Maintenant, on va créer le fichier de configuration <code>configuration.yml</code> dans le dossier <code>./data/authelia/config</code>. Voici un exemple de configuration de base :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">theme</span>: <span style="color:#ae81ff">auto</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">default_redirection_url</span>: <span style="color:#ae81ff">https://makhal.tuto</span> <span style="color:#75715e"># Ou https://auth.makhal.tuto par exemple</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">server</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host</span>: <span style="color:#ae81ff">0.0.0.0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">9091</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">log</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">level</span>: <span style="color:#ae81ff">info</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">totp</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">issuer</span>: <span style="color:#ae81ff">auth.makhal.tuto</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">authentication_backend</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">file</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/config/users.yml</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">password</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">algorithm</span>: <span style="color:#ae81ff">argon2id</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">iterations</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">salt_length</span>: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">parallelism</span>: <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">1024</span> <span style="color:#75715e"># En KiB. Pour la production, envisagez des valeurs plus élevées.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">access_control</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">default_policy</span>: <span style="color:#ae81ff">deny</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">domain</span>: <span style="color:#e6db74">&#34;*.makhal.tuto&#34;</span> <span style="color:#75715e"># Protège tous les sous-domaines</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">policy</span>: <span style="color:#ae81ff">two_factor</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Si vous voulez que auth.makhal.tuto ne soit pas protégé par 2FA (pour la première connexion par exemple)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># - domain: &#34;auth.makhal.tuto&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#   policy: one_factor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">session</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">authelia_session</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">domain: makhal.tuto # Important </span>: <span style="color:#ae81ff">doit être le domaine parent pour le SSO entre sous-domaines</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">expiration</span>: <span style="color:#ae81ff">3600</span> <span style="color:#75715e"># 1 heure</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">inactivity</span>: <span style="color:#ae81ff">300</span> <span style="color:#75715e"># 5 minutes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">regulation</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">max_retries</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">find_time</span>: <span style="color:#ae81ff">120</span> <span style="color:#75715e"># 2 minutes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ban_time</span>: <span style="color:#ae81ff">300</span> <span style="color:#75715e"># 5 minutes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">storage</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">local</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/config/db.sqlite3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">notifier</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">filesystem</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">filename</span>: <span style="color:#ae81ff">/config/notification.txt</span>
</span></span></code></pre></div><p>Dans cette configuration, on a :</p>
<ul>
<li>Le serveur écoute sur le port 9091.</li>
<li>Le niveau de log est défini sur <code>info</code>.</li>
<li>On utilise un backend d&rsquo;authentification basé sur un fichier <code>users.yml</code> (que nous allons créer plus tard).</li>
<li>La politique d&rsquo;accès par défaut est de refuser l&rsquo;accès.</li>
<li>On définit une règle d&rsquo;accès pour le domaine <code>makhal.tuto</code> (et ses sous-domaines) qui nécessite une authentification à deux facteurs.</li>
<li>La session est configurée pour expirer après 5 minutes d&rsquo;inactivité (ou au bout d'1 heure maximum).</li>
<li>La régulation est configurée pour limiter les tentatives de connexion à 3, avec un temps de blocage de 5 minutes.</li>
</ul>
<h3 id="création-des-utilisateurs">Création des utilisateurs</h3>
<p>Maintenant, nous allons créer le fichier <code>users.yml</code> dans le dossier <code>./data/authelia/config</code>. Ce fichier contiendra les utilisateurs et leurs mots de passe. Voici un exemple de contenu pour ce fichier :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">users</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">alice</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">displayname</span>: <span style="color:#ae81ff">Alice</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">password</span>: <span style="color:#e6db74">&#34;$argon2id$v=19$m=1024,t=1,p=8$eW91cl9zYWx0$eW91cl9zYWx0&#34;</span> <span style="color:#75715e"># Remplacez par votre hash</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">email</span>: <span style="color:#ae81ff">alice@makhal.tuto</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">groups</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">admins</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">dev</span>
</span></span></code></pre></div><p>Pour générer le mot de passe, vous pouvez utiliser la commande suivante (si vous avez installé Authelia localement ou via Docker exec) :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker exec -it authelia authelia hash-password <span style="color:#e6db74">&#34;votre_mot_de_passe&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ou si vous avez un binaire Authelia localement :</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># authelia hash-password &#34;votre_mot_de_passe&#34;</span>
</span></span></code></pre></div><p>Cette commande va générer un mot de passe haché que vous pouvez copier dans le fichier <code>users.yml</code>. Assurez-vous de remplacer <code>&quot;votre_mot_de_passe&quot;</code> par le mot de passe réel que vous souhaitez utiliser.</p>
<h3 id="lancement-dauthelia">Lancement d&rsquo;Authelia</h3>
<p>Normalement, vous avez tout configuré, il ne reste plus qu&rsquo;à lancer Authelia avec Docker Compose :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker compose up -d
</span></span><span style="display:flex;"><span><span style="color:#75715e"># dans le répertoire où se trouve le fichier docker-compose.yaml</span>
</span></span></code></pre></div><p>Et si vous avez bien configuré Traefik, vous devriez pouvoir accéder à Authelia via <code>https://auth.makhal.tuto</code>. Vous serez redirigé vers la page de connexion d&rsquo;Authelia, comme suit :</p>
<p><img src="/images/sysadmin/authelia/page-login.png" alt="alt text"></p>
<p>Authelia, c&rsquo;est vraiment simple à mettre en place et à utiliser. Si vous voulez vraiment aller plus loin, vous pouvez configurer des règles d&rsquo;accès plus complexes, des notifications par email, des intégrations avec d&rsquo;autres services, etc.</p>
<p>Je vous recommande de lire la <a href="https://www.authelia.com/integration/prologue/get-started/">documentation officielle d&rsquo;Authelia</a> pour en savoir plus sur les fonctionnalités avancées et les options de configuration.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Authelia est un excellent outil pour sécuriser vos applications web et services en centralisant l&rsquo;authentification et l&rsquo;autorisation. Avec Traefik, il s&rsquo;intègre facilement et permet de protéger vos services avec une authentification robuste.
Dans cet article, nous avons vu comment installer Authelia avec Traefik, configurer les utilisateurs et les règles d&rsquo;accès, et lancer le service.</p>
<p>J&rsquo;espère que cet article vous a été utile et que vous avez pu mettre en place Authelia avec Traefik sans trop de difficultés. Si vous avez des questions ou des suggestions, n&rsquo;hésitez pas à m&rsquo;envoyer un message sur LinkedIn.</p>

        </p>
        
        
    </div>

    <div class="prev-next">
        
            
                
<div class="prev-post">
    <p>
        <a href="/posts/sysadmin/gitops/gitops/">
            &#8592;
            :
            C&#39;est quoi GitOps au juste ?
        </a>
    </p>
    <p class="prev-post-date">
        mai 16, 2025
    </p>
</div>



<div class="next-post">
    <p>
        <a href="/posts/sysadmin/antomie-container/antomie_container/">
            :
            C&#39;est quoi vraiment un conteneur ?
            &#8594;
        </a>
    </p>
        <p class="next-post-date">
            juin 14, 2025
        </p>
</div>


            
        
    </div>
</div>



    

        </main><footer class="footer">
    
    

    
    <span>&copy; 2025 makhal.fr</span>
    
</footer>
</body>
</html>
