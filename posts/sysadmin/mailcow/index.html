<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --accent-color: #FF4D4D;
        }
    </style>

    
    
    
    
    
    

    
    <title>Mailcow le serveur mail tout-en-un</title>
    <meta name="description" content="">
    <meta name="keywords" content='blog, makhal, cyber, SIEM, BUT R&amp;T, mailcow, mail, sysadmin, docker'>

    <meta property="og:url" content="https://makhal.fr/posts/sysadmin/mailcow/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Mailcow le serveur mail tout-en-un">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://makhal.fr/images/avatar.jpg">
    <meta property="og:image:secure_url" content="https://makhal.fr/images/avatar.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Mailcow le serveur mail tout-en-un">
    <meta name="twitter:description" content="">
    <meta property="twitter:domain" content="https://makhal.fr/posts/sysadmin/mailcow/">
    <meta property="twitter:url" content="https://makhal.fr/posts/sysadmin/mailcow/">
    <meta name="twitter:image" content="https://makhal.fr/images/avatar.jpg">

    
    <link rel="canonical" href="https://makhal.fr/posts/sysadmin/mailcow/" />

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.min.css" media="print">

    
    <link rel="stylesheet" type="text/css" href="/css/main.min.css">

    
    <link id="dark-theme" rel="stylesheet" href="/css/dark.min.css">

    
    <script src="/js/bundle.min.893af8dd3b65bd0ffe90e7af33847bd6dc9180b8fa6d6659a212a6f4b62d3e01.js" integrity="sha256-iTr43TtlvQ/&#43;kOevM4R71tyRgLj6bWZZohKm9LYtPgE="></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6QF6WSBEBS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-6QF6WSBEBS');
    </script>
    
    
          <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&display=swap">
    
    
</head>
<body>
        <script type="text/javascript">
            
            setThemeByUserPref();
        </script><header class="header">
    <nav class="header-nav">
        
        
            <div class="avatar">
                <a href="https://makhal.fr/">
                    <img src="https://makhal.fr//images/avatar.jpg" alt="avatar" />
                </a>
            </div>
        

        
        <div class="nav-title">
            <a class="nav-brand" href="https://makhal.fr/">makhal.fr</a>
        </div>

        
        <div class="nav-links">
            
                <div class="nav-link">
                    <a href="https://makhal.fr/posts/"> Posts </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://makhal.fr/tags/"> Tags </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://makhal.fr/pages/about/"> Bio </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://www.youtube.com/@makhalX"><span data-feather='youtube'></span>  </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://www.linkedin.com/in/mohamad-el-akhal-8b8319221/"><span data-feather='linkedin'></span>  </a>
                </div>
            
                <div class="nav-link">
                    <a href="https://github.com/tutanka01"><span data-feather='github'></span>  </a>
                </div>
            

            
            <span class="nav-icons-divider"></span>

            <div class="nav-link" id="hamburger-menu-toggle">
                <span id="hamburger-menu-toggle-screen-reader-target" class="sr-only">menu</span>
                <a>
                    <span data-feather="menu"></span>
                </a>
            </div>

            
            <ul class="nav-hamburger-list visibility-hidden">   
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/posts/"> Posts </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/tags/"> Tags </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://makhal.fr/pages/about/"> Bio </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://www.youtube.com/@makhalX"><span data-feather='youtube'></span>  </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://www.linkedin.com/in/mohamad-el-akhal-8b8319221/"><span data-feather='linkedin'></span>  </a>
                    </li>
                
                    <li class="nav-item">
                        <a href="https://github.com/tutanka01"><span data-feather='github'></span>  </a>
                    </li>
                
        </div>
    </nav>
</header>
<main id="content">
    <div class="post container">
    <div class="post-header-section">
        <h1>Mailcow le serveur mail tout-en-un</h1>
        <small role="doc-subtitle"></small>
        <p class="post-date">
            février 8, 2025
        </p>

        <ul class="post-tags">
        
            <li class="post-tag"><a href="https://makhal.fr/tags/mailcow">mailcow</a></li>
        
            <li class="post-tag"><a href="https://makhal.fr/tags/mail">mail</a></li>
        
            <li class="post-tag"><a href="https://makhal.fr/tags/sysadmin">sysadmin</a></li>
        
            <li class="post-tag"><a href="https://makhal.fr/tags/docker">docker</a></li>
        
        </ul>
    </div>

    <div class="post-content">
        <p>
            <p>Bonjour à tous et bienvenus dans ce nouveau post, où cette fois-ci je vais vous présenter Mailcow :<br>
<img src="/images/sysadmin/mailcow/mailcow.png" alt="(mailcow)"></p>
<h2 id="introduction">Introduction</h2>
<p>Vous ne connaissez pas Mailcow ? Je vous explique. Mailcow est un serveur mail tout-en-un, ce qui veut dire qu&rsquo;il regroupe tant le serveur SMTP, IMAP, POP3, que le webmail. Mailcow utilise Docker pour faciliter le déploiement et la gestion de ses services. Parce qu&rsquo;en plus des services classiques, Mailcow propose de l&rsquo;analyse des spams, des virus&hellip; Tout cela, bien entendu, est sécurisé avec des mises à jour régulières.</p>
<p>Voilà, selon la doc, la liste complète des différents containers qui sont déployés avec Mailcow :<br>
<img src="/images/sysadmin/mailcow/fonctionnalites.png" alt="(fonctionnalites)"></p>
<p>Comme vous pouvez le voir, Mailcow est super complet. On passe tant par le DNS jusqu&rsquo;à l&rsquo;analyse des fichiers Word, Excel&hellip; !!</p>
<p>En résumé, Mailcow est la solution à déployer si vous voulez quitter Gmail, Outlook, Yahoo&hellip; pour votre propre serveur mail auto-hébergé.</p>
<p>Dans ce post, je vais vous expliquer comment déployer Mailcow sur un serveur Debian 12. Avec les caractéristiques suivantes :</p>


<div style="display: flex; justify-content: center;">
<table style="border: 1px solid black;">
    <tr>
        <th style="border: 1px solid black;">Ressource</th>
        <th style="border: 1px solid black;">Spécification</th>
    </tr>
    <tr>
        <td style="border: 1px solid black;">CPU</td>
        <td style="border: 1px solid black;">2 vCPU</td>
    </tr>
    <tr>
        <td style="border: 1px solid black;">RAM</td>
        <td style="border: 1px solid black;">7 GB</td>
    </tr>
    <tr>
        <td style="border: 1px solid black;">Disque</td>
        <td style="border: 1px solid black;">30 GB</td>
    </tr>
</table>
</div>

<blockquote>
<p><strong>Note :</strong> Je vais déployer Mailcow dans mon HomeLab, donc je vais utiliser une VM sur mon Proxmox avec un DNS local. Ceci n&rsquo;est pas un tuto pour le déploiement en production, mais vous pouvez l&rsquo;adapter pour votre cas. Un prochain post sera consacré à la mise en place de Mailcow en production.</p></blockquote>
<h2 id="mise-en-place">Mise en place</h2>
<p>Avant de commencer à manipuler notre VM et installer Docker et Mailcow à l&rsquo;intérieur, nous devons nous assurer que la configuration DNS est correcte. Moi, je suis dans mon HomeLab, donc je n&rsquo;ai pas de serveur DNS public. J&rsquo;utilise PiHole pour le DNS. Si jamais vous voulez un tuto pour déployer PiHole, n&rsquo;hésitez pas à me le demander.</p>
<p>Donc, on va se rendre sur notre PiHole, et on va ajouter un enregistrement A dans le DNS local, pour pointer un domaine vers notre VM qui va héberger Mailcow :<br>
<img src="/images/sysadmin/mailcow/dns-pihole.png" alt="Pi-Hole-DNS"></p>
<p>Une fois que c&rsquo;est fait, on peut passer à l&rsquo;installation de Docker et Mailcow.</p>
<h3 id="installation-de-docker">Installation de Docker</h3>
<p>L&rsquo;installation de Docker pour vous n&rsquo;a normalement plus de secret. Il faut simplement <code>wget</code> le script d&rsquo;installation et l&rsquo;exécuter :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://get.docker.com -o get-docker.sh
</span></span><span style="display:flex;"><span>sudo sh get-docker.sh
</span></span></code></pre></div><p>Une fois que c&rsquo;est fait, on peut vérifier que Docker est bien installé :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run hello-world
</span></span></code></pre></div><p><img src="/images/sysadmin/mailcow/docker-inst.png" alt="Docker inst"></p>
<h3 id="installation-de-mailcow">Installation de Mailcow</h3>
<p>Maintenant que Docker est installé, on peut passer à l&rsquo;installation de Mailcow. Pour cela, on va cloner le repo Git de Mailcow.</p>
<p>Mais avant ça, il faut être sûr qu&rsquo;on est root dans notre machine pour ne pas avoir des problèmes de permissions :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo su
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># umask</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0022</span> <span style="color:#75715e"># &lt;- Vérifiez que c&#39;est bien 0022</span>
</span></span></code></pre></div><p>Maintenant, on peut cloner le repo (Mailcow recommande de le cloner dans <code>/opt</code>) :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /opt
</span></span><span style="display:flex;"><span>git clone https://github.com/mailcow/mailcow-dockerized
</span></span><span style="display:flex;"><span>cd mailcow-dockerized
</span></span></code></pre></div><p>On va maintenant générer un fichier de configuration pour Mailcow, où on va devoir définir le nom de domaine du serveur :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./generate_config.sh
</span></span></code></pre></div><p><img src="/images/sysadmin/mailcow/gen-config.png" alt="Gen config"></p>
<p>Comme vous pouvez le voir, le script m&rsquo;a demandé de définir le nom de domaine. J&rsquo;ai mis <code>mail.makhal.local</code>, qui est le domaine que j&rsquo;ai ajouté dans mon PiHole. Puis, il m&rsquo;a demandé quelle branche de Mailcow je veux utiliser. Il existe deux branches : la stable et la nightly. J&rsquo;ai choisi la stable. Mais si vous voulez avoir les dernières fonctionnalités, vous pouvez choisir la nightly.</p>
<p>Maintenant, tout est prêt. Il nous reste plus qu&rsquo;à pull nos images Docker et lancer Mailcow :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker compose pull
</span></span></code></pre></div><p><img src="/images/sysadmin/mailcow/docker-pull.png" alt="Docker Pull"></p>
<p>Puis, on peut lancer Mailcow :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker compose up -d
</span></span></code></pre></div><p><img src="/images/sysadmin/mailcow/compose-up.png" alt="Compose up"></p>
<p>Et voilà, Mailcow est lancé. Vous pouvez maintenant vous connecter à l&rsquo;interface web de Mailcow en allant sur <code>https://mail.makhal.local</code> :</p>
<p><img src="/images/sysadmin/mailcow/webui.png" alt="WebUI"></p>
<p>Les login par défaut sont :</p>
<ul>
<li><strong>Utilisateur :</strong> <code>admin</code></li>
<li><strong>Mot de passe :</strong> <code>moohoo</code></li>
</ul>
<p>Et voilà le dashboard de Mailcow :</p>
<p><img src="/images/sysadmin/mailcow/dashboard-cow.png" alt="Dashboard"></p>
<p>Comme vous pouvez le voir, Mailcow est très paramétrable. Vous pouvez ajouter des domaines, des utilisateurs, des alias&hellip; Tout ce que vous voulez. Je vous laisse faire un petit tour pour découvrir toutes les fonctionnalités de Mailcow. Nous, ici, on va se contenter de créer un utilisateur pour accéder à notre webmail.</p>
<p>Bien entendu, la première chose qu&rsquo;on doit faire, c&rsquo;est de changer le mot de passe de l&rsquo;utilisateur <code>admin</code>. Pour cela, on va dans <code>Configuration -&gt; Accès -&gt; Éditer</code> (sur admin) :</p>
<p><img src="/images/sysadmin/mailcow/modif-pass.png" alt="Modif pass"></p>
<p>Cliquez sur <code>Éditer</code>, puis saisissez le nouveau mot de passe dans les champs prévus à cet effet. Une fois validé, le mot de passe sera immédiatement mis à jour. Cette étape est cruciale pour sécuriser votre installation, surtout si vous prévoyez de l&rsquo;exposer sur Internet.</p>
<p>Maintenant que le mot de passe est changé, on peut ajouter un domaine. Ce domaine sera celui de nos futurs utilisateurs.</p>
<p>Pour cela, on va dans <code>Courriel -&gt; Configuration -&gt; Ajouter un domaine</code> :</p>
<p><img src="/images/sysadmin/mailcow/domaine.png" alt="Domaine"></p>
<p>Une fois que vous aurez cliqué, vous verrez ce menu :</p>
<p><img src="/images/sysadmin/mailcow/add-domain.png" alt="Add domain"></p>
<p>Dans ce menu vraiment très complet, il faudra définir le domaine, des étiquettes pour organiser si jamais vous avez plusieurs domaines. Et surtout, le sélecteur DKIM, et la taille de clé qu&rsquo;il va générer pour ce DKIM.</p>
<blockquote>
<p>Si vous ne savez pas ce que c&rsquo;est DKIM ou même SPF, je vous invite à lire mon post sur <a href="/posts/old/messagerie/dmark_dkim_spf">les différents protocoles de sécurisation mail</a>.</p></blockquote>
<p>Une fois que vous avez rempli tout ça, vous pouvez cliquer sur <code>Ajouter le domaine et redémarrer SOGo</code>, et vous aurez votre domaine dans la liste des domaines.</p>
<p><img src="/images/sysadmin/mailcow/add-domain-2.png" alt="add-domain"></p>
<p>Aussi, si vous appuyez sur le bouton <code>DNS</code>, vous aurez les enregistrements DNS à ajouter pour que votre domaine soit bien configuré. Dans mon cas, je suis dans mon HomeLab, donc je n&rsquo;ai pas besoin de les ajouter. Mais voilà à quoi ça ressemble :</p>
<p><img src="/images/sysadmin/mailcow/DNS.png" alt="DNS"></p>
<p>Maintenant que le domaine est ajouté, on peut ajouter un utilisateur. Pour cela, on va dans :</p>
<p><img src="/images/sysadmin/mailcow/add-user.png" alt="ADD USER"></p>
<p>Une fois dedans, il faudra remplir le formulaire suivant :</p>
<p><img src="/images/sysadmin/mailcow/add-user-2.png" alt="add user 2"></p>
<p>Maintenant que l&rsquo;utilisateur est ajouté, vous pouvez vous connecter à votre webmail en allant sur <code>https://mail.makhal.local/SOGo/</code> :</p>
<p><img src="/images/sysadmin/mailcow/sogo-1.png" alt="SOGO"></p>
<p>Et voilà !! Nous sommes à l&rsquo;intérieur de notre webmail. Vous pouvez envoyer et recevoir des mails, créer des dossiers, des règles&hellip; Tout ce que vous voulez.</p>
<p><img src="/images/sysadmin/mailcow/sogo-2.png" alt="SOGO - 2"></p>
<h2 id="conclusion">Conclusion</h2>
<p>Mailcow est une solution complète et facile à déployer pour ceux qui souhaitent quitter les services de messagerie traditionnels comme Gmail ou Outlook. Bien que ce guide soit orienté vers un déploiement en HomeLab, il peut facilement être adapté pour un usage en production avec quelques ajustements supplémentaires. N&rsquo;hésitez m&rsquo;envoyer vos questions si vous en avez.</p>
<p>Merci d&rsquo;avoir lu ce post, et à bientôt pour un prochain post.</p>

        </p>
        
        
    </div>

    <div class="prev-next">
        
            
                
<div class="prev-post">
    <p>
        <a href="/posts/cyber/ai/sentinel/">
            &#8592;
            :
            Détecteur d&#39;anomalies réseau IA pour Proxmox
        </a>
    </p>
    <p class="prev-post-date">
        janvier 26, 2025
    </p>
</div>



<div class="next-post">
    <p>
        <a href="/posts/sysadmin/distibuted-systems/">
            :
            C&#39;est quoi un système distribué ?
            &#8594;
        </a>
    </p>
        <p class="next-post-date">
            février 15, 2025
        </p>
</div>


            
        
    </div>
</div>



    

        </main><footer class="footer">
    
    

    
    <span>&copy; 2025 makhal.fr</span>
    
</footer>
</body>
</html>
